
<div class="image-comparisons-slider-section section-width-{{ section.settings.section_width }} align-{{ section.settings.alignment }} header-size-{{ section.settings.header_size }} color-scheme-{{ section.settings.color_scheme }} {% if section.settings.remove_default_space %}no-default-space{% endif %}" style="padding-top:{{ section.settings.padding_top }}px; padding-bottom:{{ section.settings.padding_bottom }}px;">
  {% if section.settings.heading != blank %}
    <h2>{{ section.settings.heading }}</h2>
  {% endif %}
  {% if section.settings.description != blank %}
    <div class="section-description">{{ section.settings.description }}</div>
  {% endif %}

  <slider-component class="comparison-slider-outer">
    <div class="slider" id="Slider-{{ section.id }}" style="display: flex; overflow-x: auto; scroll-snap-type: x mandatory;">
      {% for block in section.blocks %}
        <div id="Slide-{{ section.id }}-{{ forloop.index0 }}" class="comparison-slide" style="width: 100%; flex: 0 0 100%; scroll-snap-align: start; justify-content: {{ block.settings.slider_position }};">
          <div class="comparison-slider-wrapper" style="width:{{ block.settings.slider_width }}%; float:{{ block.settings.slider_position }};">
            <div class="comparison-slider ratio-{{ block.settings.image_ratio }} {% if block.settings.image_ratio == 'custom' %}custom-ratio{% endif %}" {% if block.settings.image_ratio == 'custom' and block.settings.custom_ratio != blank %}data-custom-ratio="{{ block.settings.custom_ratio }}"{% endif %}>
              {% if block.settings.before_image != blank and block.settings.after_image != blank %}
                <div class="comparison-slider-inner">
                  <div class="comparison-image before">
                    <img src="{{ block.settings.before_image | img_url: 'master' }}" alt="Before image">
                    {% if block.settings.show_after_before_text %}
                      <span class="comparison-label before-label">Before</span>
                    {% endif %}
                  </div>
                  <div class="comparison-image after">
                    <img src="{{ block.settings.after_image | img_url: 'master' }}" alt="After image">
                    {% if block.settings.show_after_before_text %}
                      <span class="comparison-label after-label">After</span>
                    {% endif %}
                  </div>
                  <input type="range" min="0" max="100" value="50" class="slider-range" aria-label="Image comparison slider">
                </div>
              {% else %}
                <div style="color:#888; text-align:center; padding:40px 0;">Please select both before and after images.</div>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
    <button name="previous" type="button" class="slider-button slider-button--prev" aria-label="Previous"><</button>
    <button name="next" type="button" class="slider-button slider-button--next" aria-label="Next">></button>
    <div class="slider-counter"><span class="slider-counter--current">1</span>/<span class="slider-counter--total">{{ section.blocks.size }}</span></div>
  </slider-component>
</div>

<style>
.image-comparisons-slider-section { max-width: 1200px; margin: 0 auto; }
.section-width-default { max-width: 1200px; }
.section-width-fluid { max-width: 100%; }
.section-width-stretch { width: 100vw; margin-left: calc(50% - 50vw); }
.section-width-full { width: 100vw; margin-left: calc(50% - 50vw); }
.align-left { text-align: left; }
.align-center { text-align: center; }
.align-right { text-align: right; }
.header-size-small h2 { font-size: 1.5rem; }
.header-size-medium h2 { font-size: 2rem; }
.header-size-large h2 { font-size: 2.5rem; }
.no-default-space { margin-top: 0 !important; margin-bottom: 0 !important; }
.comparison-slider-outer { position: relative; }
.comparison-slide { display: flex; align-items: center; justify-content: center; }
.comparison-slider-wrapper { position: relative; }
.comparison-slider { position: relative; width: 100%; }
.comparison-slider-inner { position: relative; width: 100%; overflow: hidden; }
.comparison-image { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
.comparison-image img { width: 100%; height: 100%; object-fit: cover; display: block; }
.comparison-image.after { clip-path: inset(0 0 0 50%); z-index: 2; }
.comparison-label { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.5); color: #fff; padding: 2px 8px; border-radius: 4px; font-size: 0.9em; }
.after-label { left: auto; right: 10px; }
.slider-range { position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); width: 80%; z-index: 3; }
.ratio-adapt .comparison-slider-inner { aspect-ratio: auto; }
.ratio-square .comparison-slider-inner { aspect-ratio: 1/1; }
.ratio-portrait .comparison-slider-inner { aspect-ratio: 3/4; }
.ratio-landscape .comparison-slider-inner { aspect-ratio: 4/3; }
.ratio-custom .comparison-slider-inner {
  aspect-ratio: var(--custom-ratio, 1/1);
}
.slider-button { position: absolute; top: 50%; transform: translateY(-50%); background: #fff; border: 1px solid #ccc; border-radius: 50%; width: 36px; height: 36px; z-index: 10; cursor: pointer; }
.slider-button--prev { left: 10px; }
.slider-button--next { right: 10px; }
.slider-counter { position: absolute; bottom: 10px; right: 20px; background: rgba(0,0,0,0.5); color: #fff; padding: 2px 8px; border-radius: 4px; font-size: 0.9em; z-index: 10; }
@media (max-width: 768px) {
  .image-comparisons-slider-section { max-width: 100%; }
  .comparison-slide { flex-direction: column; }
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
  var sliders = document.querySelectorAll('.comparison-slider-inner');
  sliders.forEach(function(slider) {
    var before = slider.querySelector('.comparison-image.before img');
    var after = slider.querySelector('.comparison-image.after');
    var range = slider.querySelector('.slider-range');
    if (before && after && range) {
      range.addEventListener('input', function() {
        after.style.clipPath = 'inset(0 0 0 ' + range.value + '%)';
      });
    }
  });
  // Custom ratio support
  document.querySelectorAll('.comparison-slider.custom-ratio').forEach(function(slider) {
    var ratio = slider.getAttribute('data-custom-ratio');
    if (ratio) {
      var aspect = ratio.includes(':') ? (parseFloat(ratio.split(':')[0]) / parseFloat(ratio.split(':')[1])) : parseFloat(ratio);
      slider.querySelector('.comparison-slider-inner').style.aspectRatio = aspect;
    }
  });
});
</script> 

{% schema %}
    {
      "name": "Image Comparisons Slider",
      "settings": [
        {
          "type": "select",
          "id": "section_width",
          "label": "Section width",
          "options": [
            { "value": "default", "label": "Default" },
            { "value": "fluid", "label": "Fluid container" },
            { "value": "stretch", "label": "Stretch width" },
            { "value": "full", "label": "Full width" }
          ],
          "default": "default"
        },
        {
          "type": "color_scheme",
          "id": "color_scheme",
          "label": "Color scheme"
        },
        {
          "type": "header",
          "content": "Section header"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description"
        },
        {
          "type": "select",
          "id": "header_size",
          "label": "Header size",
          "options": [
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "medium"
        },
        {
          "type": "select",
          "id": "alignment",
          "label": "Alignment",
          "options": [
            { "value": "left", "label": "Left" },
            { "value": "center", "label": "Center" },
            { "value": "right", "label": "Right" }
          ],
          "default": "left"
        },
        {
          "type": "header",
          "content": "Section padding"
        },
        {
          "type": "range",
          "id": "padding_top",
          "label": "Padding top",
          "min": 0,
          "max": 100,
          "step": 4,
          "default": 32
        },
        {
          "type": "range",
          "id": "padding_bottom",
          "label": "Padding bottom",
          "min": 0,
          "max": 100,
          "step": 4,
          "default": 32
        },
        {
          "type": "checkbox",
          "id": "remove_default_space",
          "label": "Remove default space between sections",
          "default": false
        }
      ],
      "blocks": [
        {
          "type": "comparison",
          "name": "Before/After Image",
          "settings": [
            {
              "type": "image_picker",
              "id": "before_image",
              "label": "Before image"
            },
            {
              "type": "image_picker",
              "id": "after_image",
              "label": "After image"
            },
            {
              "type": "select",
              "id": "slider_width",
              "label": "Width",
              "options": [
                { "value": "50", "label": "50%" },
                { "value": "66", "label": "66%" },
                { "value": "75", "label": "75%" },
                { "value": "100", "label": "100%" }
              ],
              "default": "100"
            },
            {
              "type": "select",
              "id": "slider_position",
              "label": "Position",
              "options": [
                { "value": "left", "label": "Left" },
                { "value": "right", "label": "Right" }
              ],
              "default": "left"
            },
            {
              "type": "checkbox",
              "id": "show_after_before_text",
              "label": "Show after before text",
              "default": true
            },
            {
              "type": "select",
              "id": "image_ratio",
              "label": "Image ratio",
              "options": [
                { "value": "adapt", "label": "Adapt to image" },
                { "value": "square", "label": "Square (1:1)" },
                { "value": "portrait", "label": "Portrait (3:4)" },
                { "value": "landscape", "label": "Landscape (4:3)" },
                { "value": "custom", "label": "Custom" }
              ],
              "default": "adapt"
            },
            {
              "type": "text",
              "id": "custom_ratio",
              "label": "Custom ratio (e.g. 16:9 or 1.5)",
              "default": "",
              "info": "Only used if Image ratio is Custom"
            }
          ]
        }
      ],
      "max_blocks": 10,
      "presets": [
        {
          "name": "Image Comparisons Slider",
          "category": "Image"
        }
      ]
    }
    {% endschema %}