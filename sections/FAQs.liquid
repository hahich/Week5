  {% assign section_color_scheme = section.settings.color_scheme | default: settings.color_scheme %}
  {% assign page_width = section.settings.section_width %}
  {% if page_width == blank or page_width == 'default' %}
    {% assign page_width = settings.page_width | default: 'default' %}
  {% endif %}

  {% comment %} Calculate section width based on settings {% endcomment %}
  {% assign calculated_width = '800px' %}
  {% if page_width == 'fluid' %}
    {% assign calculated_width = settings.page_width | default: '1200px' | append: 'px' %}
  {% elsif page_width == 'stretch' %}
    {% assign stretch_width = settings.page_width | default: '1200px' | append: 'px' %}
    {% assign calculated_width = stretch_width | minus: 40 | append: 'px' %}
  {% elsif page_width == 'full' %}
    {% assign calculated_width = '100vw' %}
  {% endif %}

  <div
    class="
      faqs-section
      section-width-{{ page_width }}
      header-size-{{ section.settings.header_size }}
      {% if section.settings.remove_default_space %}no-default-space{% endif %}
      color-{{ section_color_scheme }}
    "
    style="padding-top:{{ section.settings.padding_top }}px; padding-bottom:{{ section.settings.padding_bottom }}px; max-width: {{ calculated_width }}; margin: 0 auto;"
  >
    {% if section.settings.heading != blank %}
      <h2 style="font-weight: {{ section.settings.header_weight }}; font-size: {{ section.settings.header_size }}px; text-align: {{ section.settings.alignment }};">
        {{ section.settings.heading }}
      </h2>
    {% endif %}
    {% if section.settings.description != blank %}
      <div class="section-description" style="text-align: {{ section.settings.alignment }};">
        {{ section.settings.description }}
      </div>
    {% endif %}

    <div class="faqs-list">
      {% for block in section.blocks %}
        <div class="faq-item" {{ block.shopify_attributes }}>
          <button class="faq-question" aria-expanded="false">
            <span
              class="faq-question-text"
              ><strong>{{ block.settings.question }}</strong></span
            >
            <span class="faq-toggle">+</span>
          </button>
          <div class="faq-answer">
            {{ block.settings.answer }}
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

  <style>
    .faqs-section {
      margin: 0 auto;
      color: rgb(var(--color-foreground));
      background: rgb(var(--color-background));
      padding: 0 3rem;
    }
    .section-width-default {
      max-width: 800px;
    }
    .section-width-stretch {
      padding: 0 20px;
    }
    .section-width-full {
      width: 100vw;
    }
    .align-left {
      text-align: left;
    }
    .align-center {
      text-align: center;
    }
    .align-right {
      text-align: right;
    }
    .header-size-small h2 {
      font-size: 1.5rem;
    }
    .header-size-medium h2 {
      font-size: 3rem;
    }
    .header-size-large h2 {
      font-size: 3.5rem;
    }
    .no-default-space {
      margin-top: 0 !important;
      margin-bottom: 0 !important;
    }
    .faq-item {
      border-bottom: 1px solid rgba(var(--color-foreground), 0.08);
      margin-bottom: 0;
      padding: 0;
    }
    .faq-question {
      width: 100%;
      background: none;
      border: none;
      outline: none;
      text-align: left;
      padding: 1.25rem 1rem;
      font-size: 1.6rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      transition: background 0.2s;
      color: rgb(var(--color-foreground));
    }
    .faq-question:hover {
      background: rgba(var(--color-foreground), 0.04);
    }
    .faq-toggle {
      font-size: 2rem;
      font-weight: 400;
      margin-left: 1rem;
      transition: transform 0.2s;
    }
    .faq-question[aria-expanded='true'] .faq-toggle {
      transform: rotate(180deg);
    }
    .faq-answer {
      margin: 0 0 1.25rem 0;
      padding-left: 1.5rem;
      color: rgb(var(--color-foreground));
      font-size: 1.5rem;
      line-height: 1.6;
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s;
    }
    .faq-answer.active {
      opacity: 1;
      max-height: 500px;
      transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s;
    }
  </style>

  <script>
    function initFAQs() {
      var faqItems = document.querySelectorAll('.faq-item');
      faqItems.forEach(function (item) {
        var btn = item.querySelector('.faq-question');
        var answer = item.querySelector('.faq-answer');

        // Remove existing event listeners to prevent duplicates
        btn.removeEventListener('click', btn.faqClickHandler);

        // Create new event handler
        btn.faqClickHandler = function () {
          var expanded = btn.getAttribute('aria-expanded') === 'true';
          // Close all
          document.querySelectorAll('.faq-question').forEach(function (b) {
            b.setAttribute('aria-expanded', 'false');
            b.querySelector('.faq-toggle').textContent = '+';
          });
          document.querySelectorAll('.faq-answer').forEach(function (a) {
            a.classList.remove('active');
            a.style.maxHeight = null;
          });
          // Open this if not already open
          if (!expanded) {
            btn.setAttribute('aria-expanded', 'true');
            btn.querySelector('.faq-toggle').textContent = 'â€“';
            answer.classList.add('active');
            answer.style.maxHeight = answer.scrollHeight + 'px';
          }
        };

        // Add event listener
        btn.addEventListener('click', btn.faqClickHandler);
      });
    }

    // Initialize on DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initFAQs);
    } else {
      initFAQs();
    }

    // Re-initialize when Shopify theme editor updates
    if (typeof Shopify !== 'undefined' && Shopify.designMode) {
      document.addEventListener('shopify:section:load', initFAQs);
      document.addEventListener('shopify:block:select', initFAQs);
    }
  </script>

  {% schema %}
  {
    "name": "FAQs",
    "settings": [
      {
        "type": "select",
        "id": "section_width",
        "label": "Section width",
        "options": [
          { "value": "default", "label": "Default" },
          { "value": "fluid", "label": "Fluid container" },
          { "value": "stretch", "label": "Stretch width" },
          { "value": "full", "label": "Full width" }
        ],
        "default": "default"
      },
      {
        "type": "color_scheme",
        "id": "color_scheme",
        "label": "Color scheme"
      },
      {
        "type": "header",
        "content": "Section header"
      },
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "FAQs"
      },
      {
        "type": "richtext",
        "id": "description",
        "label": "Description"
      },
      {
        "type": "select",
        "id": "header_size",
        "label": "Heading size",
        "options": [
          { "value": "small", "label": "Small" },
          { "value": "medium", "label": "Medium" },
          { "value": "large", "label": "Large" }
        ],
        "default": "medium"
      },
      {
        "type": "select",
        "id": "header_weight",
        "label": "Heading weight",
        "options": [
          { "value": "normal", "label": "Normal" },
          { "value": "bold", "label": "Bold" }
        ],
        "default": "normal"
      },
      {
        "type": "select",
        "id": "alignment",
        "label": "Alignment",
        "options": [
          { "value": "left", "label": "Left" },
          { "value": "center", "label": "Center" },
          { "value": "right", "label": "Right" }
        ],
        "default": "left"
      },
      {
        "type": "header",
        "content": "Section padding"
      },
      {
        "type": "range",
        "id": "padding_top",
        "label": "Padding top",
        "min": 0,
        "max": 100,
        "step": 4,
        "default": 32
      },
      {
        "type": "range",
        "id": "padding_bottom",
        "label": "Padding bottom",
        "min": 0,
        "max": 100,
        "step": 4,
        "default": 32
      },
      {
        "type": "checkbox",
        "id": "remove_default_space",
        "label": "Remove default space between sections",
        "default": false
      }
    ],
    "blocks": [
      {
        "type": "faq",
        "name": "Question",
        "settings": [
          {
            "type": "text",
            "id": "question",
            "label": "Question"
          },
          {
            "type": "richtext",
            "id": "answer",
            "label": "Answer"
          }
        ]
      }
    ],
    "max_blocks": 20,
    "presets": [
      {
        "name": "FAQs",
        "category": "Text",
        "settings": {
          "heading": "Frequently Asked Questions",
          "description": "<p>Find answers to common questions about our products and services.</p>",
          "section_width": "default",
          "color_scheme": "background-1",
          "header_size": "medium",
          "header_weight": "bold",
          "alignment": "center",
          "padding_top": 32,
          "padding_bottom": 32
        },
        "blocks": [
          {
            "type": "faq",
            "settings": {
              "question": "What is your return policy?",
              "answer": "<p>We offer a 30-day return policy for all unused items in their original packaging. Please contact our customer service team to initiate a return.</p>",
            }
          },
          {
            "type": "faq",
            "settings": {
              "question": "How long does shipping take?",
              "answer": "<p>Standard shipping typically takes 3-5 business days. Express shipping is available for 1-2 business days delivery.</p>",
            }
          },
          {
            "type": "faq",
            "settings": {
              "question": "Do you ship internationally?",
              "answer": "<p>Yes, we ship to most countries worldwide. International shipping rates and delivery times vary by location.</p>",
            }
          }
        ]
      }
    ]
  }
  {% endschema %}
