{% liquid
  assign section_color_scheme = section.settings.color_scheme | default: settings.color_scheme
  assign page_width = section.settings.page_width
  if page_width == blank or page_width == 'default'
    assign page_width = settings.page_width | default: 'default'
  endif
  assign header_size = section.settings.header_size
  assign alignment = section.settings.alignment
  assign before_image = section.settings.before_image
  assign after_image = section.settings.after_image
  assign width = section.settings.width
  assign position = section.settings.position
  assign show_text = section.settings.show_text
  assign image_ratio = section.settings.image_ratio
  assign custom_ratio = section.settings.custom_ratio
  assign padding_top = section.settings.padding_top
  assign padding_bottom = section.settings.padding_bottom
  assign remove_space = section.settings.remove_space
%}

{% comment %} Calculate section width based on settings {% endcomment %}
{% liquid
  assign calculated_width = '1410px'
  if page_width == 'fluid'
    assign calculated_width = settings.page_width | default: '1200px' | append: 'px'
  elsif page_width == 'stretch'
    assign stretch_width = settings.page_width | default: '1200px' | append: 'px'
    assign calculated_width = stretch_width | minus: 40 | append: 'px'
  elsif page_width == 'full'
    assign calculated_width = '100%'
  endif
%}

{% capture section_classes %}
  image-comparison-section
  section-width-{{ page_width }}
  color-{{ section_color_scheme }}
  {% if remove_space %}no-section-space{% endif %}
  section-padding
{% endcapture %}

<div class="{{ section_classes | strip_newlines }}" style="max-width: {{ calculated_width }}; margin: 0 auto; padding-top: {{ padding_top }}px; padding-bottom: {{ padding_bottom }}px">
  <div class="image-comparision-header text-align-{{ alignment }}">
    <h2 class="header-{{ header_size }}">{{ section.settings.heading_text }}</h2>
    <p>{{ section.settings.description_text }}</p>
  </div>
  
  <div
    class="
      image-comparison-flex
      {% if width == '100' %}
        is-full-width{% if position == 'right' %} position-right{% endif %}
      {% else %}
        {% if position == 'left' %} flex-row{% else %} flex-row-reverse{% endif %}
      {% endif %}
    "
  >
    <div
      class="image-comparison-left{% if width == '100' %} is-full-width{% endif %}"
      data-width="{{ width }}"
    >
      <div
        class="image-comparison-slider"
        id="image-comparison-{{ section.id }}"
        data-aspect-ratio="{% if image_ratio == 'square' %}1/1{% elsif image_ratio == 'portrait' %}3/4{% elsif image_ratio == 'landscape' %}4/3{% elsif image_ratio == 'custom' and custom_ratio != blank %}{{ custom_ratio | replace: ':', '/' }}{% endif %}"
      >
        <img
          class="before-image"
          src="{{ before_image | image_url }}"
          alt="Before"
          loading="lazy"
          width="800"
          height="600"
        >
        <img
          class="after-image"
          src="{{ after_image | image_url }}"
          alt="After"
          loading="lazy"
          width="800"
          height="600"
        >
        {% if show_text %}
          <span class="image-comparison-label before">BEFORE</span>
          <span class="image-comparison-label after">AFTER</span>
        {% endif %}
        <div class="slider-bar">
          <button class="slider-bar-button__pull" type="button">
            <svg width="10" height="24" viewBox="0 0 10 24" fill="none">
              <rect width="2" height="24" rx="1" fill="currentColor"></rect>
              <rect x="4" width="2" height="24" rx="1" fill="currentColor"></rect>
              <rect x="8" width="2" height="24" rx="1" fill="currentColor"></rect>
            </svg>
          </button>
        </div>
      </div>
    </div>
    
    <div class="image-content-wrapper{% if width == '100' %} is-full-width{% endif %}" data-content-width="{{ width }}">
      <div class="image-comparison-top">
        {% for block in section.blocks %}
          {% case block.type %}
            {% when 'heading' %}
              <div class="ip-content-block">
                <h2
                  class="image-comparison-heading"
                  data-font-size="{{ block.settings.font_size }}"
                  data-font-weight="{{ block.settings.font_weight }}"
                  data-spacing="{{ block.settings.header_spacing_bottom }}"
                  {% if block.settings.header_transform %}data-transform="uppercase"{% endif %}
                >
                  {{ block.settings.heading_text }}
                </h2>
              </div>
            {% when 'description' %}
              <div class="ip-content-block">
                <div
                  class="image-comparison-description"
                  data-font-size="{{ block.settings.font_size }}"
                  data-font-weight="{{ block.settings.font_weight }}"
                  data-spacing="{{ block.settings.spacing_bottom }}"
                >
                  {{ block.settings.description_text }}
                </div>
              </div>
            {% when 'subheading' %}
              <div class="ip-content-block">
                <p
                  class="image-comparison-subheading"
                  data-font-size="{{ block.settings.font_size }}"
                  data-font-weight="{{ block.settings.font_weight }}"
                  data-spacing="{{ block.settings.spacing_bottom }}"
                  {% if block.settings.uppercase %}data-transform="uppercase"{% endif %}
                >
                  {{ block.settings.subheading_text }}
                </p>
              </div>
            {% when 'button' %}
              <div class="ip-content-block">
                <a
                  href="{{ block.settings.button_url }}"
                  class="image-comparison-btn__{{ block.settings.button_type }}"
                  data-spacing="{{ block.settings.spacing_bottom }}"
                  {% if block.settings.button_type == 'primary' %}
                    data-bg-color="{{ block.settings.button_color }}"
                    data-text-color="{{ block.settings.button_text_color }}"
                  {% endif %}
                >
                  {{ block.settings.button_label }}
                </a>
              </div>
            {% when 'product' %}
              <div class="ip-content-block product-block">
                <div class="image-comparision-wrapper" data-spacing="{{ block.settings.spacing_bottom }}">
                  <img
                    src="{{ block.settings.product.featured_image | image_url }}"
                    alt="{{ block.settings.product.title }}"
                    width="100"
                    height="100"
                    loading="lazy"
                  >
                  <div class="ip-product-info">
                    <a
                      href="{{ block.settings.product.url }}"
                      class="image-comparison-btn__{{ block.settings.button_type }}"
                    >
                      {{ block.settings.product.title | default: 'Example prodcut title' }}
                    </a>
                    <p>{{ block.settings.product.price | money | default: '$100.00' }}</p>
                  </div>
                </div>
              </div>
          {% endcase %}
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<script src="{{ 'image-comparison.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Image Comparison",
  "settings": [
    {
      "type": "select",
      "id": "page_width",
      "label": "Section width",
      "options": [
        { "value": "default", "label": "Default" },
        { "value": "fluid", "label": "Fluid container" },
        { "value": "stretch", "label": "Stretch width" },
        { "value": "full", "label": "Full width" }
      ],
      "default": "default"
    },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme" },
    { "type": "header", "content": "Section header" },
    { "type": "text", "id": "heading_text", "label": "Heading text" },
    { "type": "richtext", "id": "description_text", "label": "Description text" },
    {
      "type": "select",
      "id": "header_size",
      "label": "Header size",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large", "label": "Large" }
      ],
      "default": "medium"
    },
    {
      "type": "select",
      "id": "alignment",
      "label": "Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    },
    { "type": "header", "content": "Section content" },
    { "type": "image_picker", "id": "before_image", "label": "Before image" },
    { "type": "image_picker", "id": "after_image", "label": "After image" },
    {
      "type": "select",
      "id": "width",
      "label": "Width",
      "options": [
        { "value": "50", "label": "50%" },
        { "value": "66", "label": "66%" },
        { "value": "75", "label": "75%" },
        { "value": "100", "label": "100%" }
      ],
      "default": "50"
    },
    {
      "type": "select",
      "id": "position",
      "label": "Position",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "right", "label": "Right" }
      ],
      "default": "left"
    },
    { "type": "checkbox", "id": "show_text", "label": "Show after before text", "default": true },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Image ratio",
      "options": [
        { "value": "adapt", "label": "Adapt to image" },
        { "value": "square", "label": "Square (1:1)" },
        { "value": "portrait", "label": "Portrait (3:4)" },
        { "value": "landscape", "label": "Landscape (4:3)" },
        { "value": "custom", "label": "Custom" }
      ],
      "default": "adapt"
    },
    {
      "type": "text",
      "id": "custom_ratio",
      "label": "Custom ratio (e.g. 16:9)",
      "default": "16:9",
      "info": "Only used if Image ratio is Custom. Please select 'Custom' above to use this value."
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Section padding top",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 32,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Section padding bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 32,
      "unit": "px"
    },
    { "type": "checkbox", "id": "remove_space", "label": "Remove default space between sections", "default": false }
  ],
  "blocks": [
    {
      "type": "heading",
      "name": "Heading",
      "limit": 1,
      "settings": [
        { "type": "text", "id": "heading_text", "label": "Heading Text", "default": "Talk about your brand" },
        { "type": "range", "id": "font_size", "label": "Font Size", "min": 16, "max": 60, "step": 2, "default": 32 },
        {
          "type": "select",
          "id": "font_weight",
          "label": "Font Weight",
          "options": [
            { "value": "400", "label": "Normal" },
            { "value": "500", "label": "Medium" },
            { "value": "600", "label": "Semi Bold" },
            { "value": "700", "label": "Bold" },
            { "value": "800", "label": "Extra Bold" }
          ],
          "default": "700"
        },
        { "type": "checkbox", "id": "header_transform", "label": "Uppercase", "default": false },
        {
          "type": "range",
          "id": "header_spacing_bottom",
          "label": "Spacing bottom",
          "min": 0,
          "max": 30,
          "step": 1,
          "default": 10,
          "unit": "px"
        }
      ]
    },
    {
      "type": "description",
      "name": "Description",
      "limit": 1,
      "settings": [
        {
          "type": "richtext",
          "id": "description_text",
          "label": "Description Text",
          "default": "<p>Share information about your brand with your customers. Describe a product, make announcements, or welcome customers to your store.</p>"
        },
        { "type": "range", "id": "font_size", "label": "Font Size", "min": 12, "max": 24, "step": 1, "default": 16 },
        {
          "type": "select",
          "id": "font_weight",
          "label": "Font Weight",
          "options": [
            { "value": "400", "label": "Normal" },
            { "value": "500", "label": "Medium" },
            { "value": "600", "label": "Semi Bold" },
            { "value": "700", "label": "Bold" },
            { "value": "800", "label": "Extra Bold" }
          ],
          "default": "400"
        },
        {
          "type": "range",
          "id": "spacing_bottom",
          "label": "Spacing bottom",
          "min": 0,
          "max": 30,
          "step": 1,
          "default": 10,
          "unit": "px"
        }
      ]
    },
    {
      "type": "subheading",
      "name": "Subheading",
      "limit": 1,
      "settings": [
        { "type": "text", "id": "subheading_text", "label": "Subheading Text", "default": "Subheading text" },
        { "type": "range", "id": "font_size", "label": "Font Size", "min": 12, "max": 36, "step": 2, "default": 14 },
        {
          "type": "select",
          "id": "font_weight",
          "label": "Font Weight",
          "options": [
            { "value": "400", "label": "Normal" },
            { "value": "500", "label": "Medium" },
            { "value": "600", "label": "Semi Bold" },
            { "value": "700", "label": "Bold" },
            { "value": "800", "label": "Extra Bold" }
          ],
          "default": "700"
        },
        { "type": "checkbox", "id": "uppercase", "label": "Uppercase", "default": false },
        {
          "type": "range",
          "id": "spacing_bottom",
          "label": "Spacing bottom",
          "min": 0,
          "max": 30,
          "step": 1,
          "default": 10,
          "unit": "px"
        }
      ]
    },
    {
      "type": "button",
      "name": "Button",
      "limit": 1,
      "settings": [
        { "type": "text", "id": "button_label", "label": "Button Label", "default": "Button label" },
        { "type": "url", "id": "button_url", "label": "Button URL" },
        {
          "type": "select",
          "id": "button_type",
          "label": "Type",
          "options": [
            { "value": "primary", "label": "Primary" },
            { "value": "outline", "label": "Outline" },
            { "value": "link", "label": "Link" }
          ],
          "default": "primary"
        },
        {
          "type": "range",
          "id": "spacing_bottom",
          "label": "Spacing bottom",
          "min": 0,
          "max": 30,
          "step": 1,
          "default": 10,
          "unit": "px"
        }
      ]
    },
    {
      "type": "product",
      "name": "Product",
      "limit": 1,
      "settings": [
        { "type": "product", "id": "product", "label": "Product" },
        {
          "type": "range",
          "id": "spacing_bottom",
          "label": "Spacing bottom",
          "min": 0,
          "max": 30,
          "step": 1,
          "default": 10,
          "unit": "px"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Image Comparison",
      "blocks": [{ "type": "heading" }, { "type": "description" }, { "type": "button" }, { "type": "product" }]
    }
  ]
}
{% endschema %}
